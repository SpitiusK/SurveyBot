# Отчёт: Вопрос с единственным выбором - Возможность неограниченного количества вариантов

**Дата**: 11 декабря 2025 г.
**Система**: SurveyBot v1.6.2
**Тема**: Анализ ограничений на создание вариантов ответов для вопросов с единственным выбором

---

## Краткое содержание

Данный отчёт демонстрирует, что **вопросы с единственным выбором поддерживают неограниченное количество вариантов** на уровне бэкенда (API, База данных, Ядро), с **опциональными ограничениями на уровне UI**, доступными во фронтенде через настраиваемые props.

---

## Бэкенд: Отсутствие жёстких ограничений

### 1. Слой базы данных

Таблица `question_options` **не имеет ограничений** на количество вариантов для одного вопроса:

```sql
CREATE TABLE question_options (
    id SERIAL PRIMARY KEY,
    question_id INT NOT NULL,
    text TEXT NOT NULL,
    order_index INT NOT NULL,  -- Диапазон: от 0 до 2 147 483 647
    -- Ограничение max_options ОТСУТСТВУЕТ
);
```

**Источник**: `src/SurveyBot.Infrastructure/Data/Configurations/QuestionOptionConfiguration.cs`

### 2. Слой доменного ядра

Сущность `Question` хранит варианты в неограниченной коллекции:

```csharp
// Ограничение на размер коллекции отсутствует
private readonly List<QuestionOption> _options = new();
public IReadOnlyCollection<QuestionOption> Options => _options.AsReadOnly();
```

**Источник**: `src/SurveyBot.Core/Entities/Question.cs`

### 3. Слой API

API принимает массивы вариантов без ограничения максимального количества. Варианты можно добавлять через:
- `POST /api/surveys` - Создание опроса с вопросами
- `PUT /api/surveys/{id}/complete` - Полное обновление опроса
- `POST /api/questions` - Добавление отдельных вопросов

---

## Фронтенд: Настраиваемое ограничение UI

Фронтенд предоставляет **настраиваемое ограничение** через компонент `OptionManager`:

```typescript
// OptionManager.tsx - Интерфейс Props
interface OptionManagerProps {
  options: string[];
  onChange: (options: string[]) => void;
  minOptions?: number;  // По умолчанию: 2
  maxOptions?: number;  // По умолчанию: 10 (настраивается)
}
```

**Источник**: `frontend/src/components/SurveyBuilder/OptionManager.tsx`

### Как работает ограничение UI

| Prop | По умолчанию | Назначение |
|------|--------------|------------|
| `minOptions` | 2 | Минимальное количество вариантов |
| `maxOptions` | 10 | Максимальное количество вариантов (только UI) |

Кнопка «Добавить вариант» отключается, когда `options.length >= maxOptions`:

```typescript
<Button
  onClick={handleAddOption}
  disabled={options.length >= maxOptions}  // Ограничение только на уровне UI
>
  Добавить вариант
</Button>
```

### Важное примечание

Это ограничение **действует только на уровне UI**. Данное ограничение:
- Может быть изменено путём передачи другого значения в prop `maxOptions`
- Не влияет на прямые вызовы API
- Не обеспечивает никакой валидации на бэкенде

---

## Заключение

| Слой | Лимит вариантов | Тип |
|------|-----------------|-----|
| **База данных** | Неограниченно | Ограничение отсутствует |
| **Ядро (Сущность)** | Неограниченно | Лимит коллекции отсутствует |
| **API** | Неограниченно | Валидация отсутствует |
| **UI фронтенда** | 10 (по умолчанию) | Настраивается через prop `maxOptions` |

**Результат**: Вопросы с единственным выбором могут иметь неограниченное количество вариантов на системном уровне. Единственным ограничением является настраиваемый лимит UI (prop `maxOptions`), который не позволяет пользователям добавлять больше вариантов через интерфейс, но может быть изменён по необходимости.

---

## Ссылки на исходный код

- Сущность: `src/SurveyBot.Core/Entities/Question.cs` (строки 91-97)
- Сущность: `src/SurveyBot.Core/Entities/QuestionOption.cs`
- База данных: `src/SurveyBot.Infrastructure/Data/Configurations/QuestionOptionConfiguration.cs`
- Фронтенд: `frontend/src/components/SurveyBuilder/OptionManager.tsx` (строки 138-145)
