project:
  name: SurveyBot Multimedia Support Enhancement
  version: 2.0.0
  description: Add multimedia support to existing question text fields
  status: planning
  approach: Extend Question entity with MediaContent field for inline media
  target_framework: .NET 8.0
  timeline_weeks: 4-6
  complexity: MEDIUM

metadata:
  created_date: 2025-11-18
  architecture_pattern: Clean Architecture
  database: PostgreSQL 15 with JSONB
  storage: File system with optional cloud migration

configuration:
  media:
    allowed_types:
      image: [jpg, jpeg, png, gif, webp]
      video: [mp4, webm, mov]
      audio: [mp3, wav, ogg, m4a]
      document: [pdf, doc, docx, txt]
    max_file_size_mb:
      image: 10
      video: 50
      audio: 20
      document: 25
    storage_path: "wwwroot/uploads/media"
    url_pattern: "/uploads/media/{year}/{month}/{filename}"
    enable_compression: true
    thumbnail_generation: true

  frontend:
    rich_text_editor: "react-quill"
    media_picker_library: "custom"
    preview_enabled: true
    inline_editing: true

  backend:
    validation_enabled: true
    virus_scanning: false  # Optional future enhancement
    cdn_integration: false  # Optional future enhancement

success_metrics:
  - name: media_upload_success_rate
    target: ">95%"
    description: Percentage of successful media uploads

  - name: response_time_increase
    target: "<200ms"
    description: Additional latency from media processing

  - name: storage_efficiency
    target: ">80%"
    description: Compression ratio for images

  - name: backward_compatibility
    target: "100%"
    description: Existing questions must work unchanged

phases:
  # ============================================================================
  # PHASE 1: Foundation & Data Model Enhancement (Week 1)
  # ============================================================================
  - name: Phase 1 - Foundation & Data Model
    priority: CRITICAL
    description: Extend Question entity with media support, create migrations
    estimated_days: 3-5
    dependencies: []

    tasks:
      - id: TASK-MM-001
        name: Design MediaContent JSON schema
        description: |
          Design the JSON structure for storing media metadata in Question.MediaContent field.
          Schema should include: media type, file path, display name, size, mime type,
          upload timestamp, alt text, thumbnail path, and order.
        type: design
        priority: CRITICAL
        assigned_to: database-agent
        dependencies: []
        effort_hours: 3
        parallel_safe: true
        files_created:
          - docs/media-content-schema.md
        files_modified: []
        acceptance_criteria:
          - JSON schema supports all media types (image, video, audio, document)
          - Schema includes accessibility fields (alt text)
          - Schema is versioned for future compatibility
          - Schema supports multiple media items per question
          - Documentation includes example JSON structures
        subtasks:
          - name: Research JSONB best practices for PostgreSQL
            description: Review PostgreSQL JSONB indexing and query patterns
          - name: Define schema version 1.0 structure
            description: Create initial schema with all required fields
          - name: Create validation rules
            description: Define JSON schema validation rules
          - name: Write example JSON
            description: Document examples for each media type

      - id: TASK-MM-002
        name: Extend Question entity with MediaContent property
        description: |
          Add MediaContent property to Question.cs entity in Core layer.
          Property should be nullable string to store JSONB data.
          Add XML documentation comments.
        type: feature
        priority: CRITICAL
        assigned_to: database-agent
        dependencies: [TASK-MM-001]
        effort_hours: 2
        parallel_safe: false
        files_created: []
        files_modified:
          - src/SurveyBot.Core/Entities/Question.cs
        acceptance_criteria:
          - MediaContent property added as nullable string
          - Property includes comprehensive XML documentation
          - Property follows existing entity conventions
          - No breaking changes to existing Question properties
          - Backward compatible with existing questions (null by default)
        subtasks:
          - name: Add MediaContent property
            description: "public string? MediaContent { get; set; }"
          - name: Add XML documentation
            description: Document purpose, format, and example usage
          - name: Verify no breaking changes
            description: Ensure existing code compiles

      - id: TASK-MM-003
        name: Create MediaItem DTO class
        description: |
          Create MediaItemDto class in Core/DTOs to represent individual media items.
          Create MediaContentDto class to represent the full MediaContent JSON structure.
          These DTOs will be used for serialization/deserialization.
        type: feature
        priority: CRITICAL
        assigned_to: database-agent
        dependencies: [TASK-MM-001]
        effort_hours: 3
        parallel_safe: true
        files_created:
          - src/SurveyBot.Core/DTOs/MediaItemDto.cs
          - src/SurveyBot.Core/DTOs/MediaContentDto.cs
        files_modified: []
        acceptance_criteria:
          - MediaItemDto includes all schema fields
          - MediaContentDto has list of MediaItemDto
          - Both DTOs include validation attributes
          - DTOs follow existing DTO naming conventions
          - JSON serialization attributes applied correctly
        subtasks:
          - name: Create MediaItemDto
            description: Properties for type, path, name, size, mime, timestamp, alt, thumbnail
          - name: Create MediaContentDto
            description: Version and Items list properties
          - name: Add validation attributes
            description: Required, MaxLength, Range attributes
          - name: Add JSON serialization attributes
            description: JsonPropertyName attributes for camelCase

      - id: TASK-MM-004
        name: Update QuestionConfiguration for MediaContent column
        description: |
          Update QuestionConfiguration.cs in Infrastructure layer to configure
          MediaContent as JSONB column in PostgreSQL with GIN index for efficient querying.
        type: feature
        priority: CRITICAL
        assigned_to: database-agent
        dependencies: [TASK-MM-002]
        effort_hours: 2
        parallel_safe: false
        files_created: []
        files_modified:
          - src/SurveyBot.Infrastructure/Data/Configurations/QuestionConfiguration.cs
        acceptance_criteria:
          - MediaContent configured as JSONB column type
          - GIN index created for MediaContent column
          - Column is nullable
          - Configuration follows existing pattern (matches OptionsJson)
          - Migration generation works correctly
        subtasks:
          - name: Add HasColumnType for JSONB
            description: "builder.Property(q => q.MediaContent).HasColumnType(\"jsonb\")"
          - name: Add GIN index
            description: "builder.HasIndex(q => q.MediaContent).HasMethod(\"gin\")"
          - name: Test migration generation
            description: Verify EF Core generates correct SQL

      - id: TASK-MM-005
        name: Generate and test database migration
        description: |
          Create EF Core migration for adding MediaContent column to Questions table.
          Review generated SQL, test migration up/down, verify no data loss.
        type: feature
        priority: CRITICAL
        assigned_to: database-agent
        dependencies: [TASK-MM-004]
        effort_hours: 2
        parallel_safe: false
        files_created:
          - src/SurveyBot.Infrastructure/Migrations/YYYYMMDDHHMMSS_AddMediaContentToQuestion.cs
        files_modified: []
        acceptance_criteria:
          - Migration adds MediaContent column as JSONB type
          - Migration creates GIN index on MediaContent
          - Migration is reversible (Down method works)
          - Existing questions remain unchanged (column is nullable)
          - Migration tested on dev database successfully
        subtasks:
          - name: Run dotnet ef migrations add
            description: "dotnet ef migrations add AddMediaContentToQuestion"
          - name: Review generated SQL
            description: Inspect Up and Down methods
          - name: Test on dev database
            description: Apply migration and verify schema
          - name: Test rollback
            description: Verify Down migration works

      - id: TASK-MM-006
        name: Create MediaContentHelper utility class
        description: |
          Create helper class in Core/Utilities for MediaContent operations.
          Methods: serialize, deserialize, validate, add media, remove media.
        type: feature
        priority: HIGH
        assigned_to: backend-agent
        dependencies: [TASK-MM-003]
        effort_hours: 4
        parallel_safe: true
        files_created:
          - src/SurveyBot.Core/Utilities/MediaContentHelper.cs
        files_modified: []
        acceptance_criteria:
          - SerializeMediaContent method converts MediaContentDto to JSON string
          - DeserializeMediaContent method converts JSON string to MediaContentDto
          - ValidateMediaContent method checks schema version and structure
          - AddMediaItem method appends new media to existing content
          - RemoveMediaItem method removes media by ID/path
          - All methods include null checks and error handling
        subtasks:
          - name: Implement serialization
            description: Use System.Text.Json with camelCase
          - name: Implement deserialization
            description: Handle null and invalid JSON gracefully
          - name: Implement validation
            description: Check schema version, required fields
          - name: Implement add/remove operations
            description: Manipulate Items list safely

  # ============================================================================
  # PHASE 2: Backend API - Media Upload & Management (Week 2)
  # ============================================================================
  - name: Phase 2 - Backend Media API
    priority: CRITICAL
    description: Implement media upload, storage, and management endpoints
    estimated_days: 5-7
    dependencies: [Phase 1 - Foundation & Data Model]

    tasks:
      - id: TASK-MM-007
        name: Create IMediaStorageService interface
        description: |
          Define interface in Core/Interfaces for media storage operations.
          Methods: SaveMediaAsync, DeleteMediaAsync, GetMediaUrlAsync,
          GenerateThumbnailAsync, ValidateMediaAsync.
        type: feature
        priority: CRITICAL
        assigned_to: backend-agent
        dependencies: [TASK-MM-006]
        effort_hours: 2
        parallel_safe: true
        files_created:
          - src/SurveyBot.Core/Interfaces/IMediaStorageService.cs
        files_modified: []
        acceptance_criteria:
          - Interface methods cover all media operations
          - Methods return appropriate result types
          - Methods include comprehensive XML documentation
          - Interface follows existing service interface patterns
          - Methods support async operations with cancellation tokens
        subtasks:
          - name: Define SaveMediaAsync method
            description: "Task<MediaItemDto> SaveMediaAsync(Stream, string filename, MediaType)"
          - name: Define DeleteMediaAsync method
            description: "Task<bool> DeleteMediaAsync(string path)"
          - name: Define GetMediaUrlAsync method
            description: "Task<string> GetMediaUrlAsync(string path)"
          - name: Define GenerateThumbnailAsync method
            description: "Task<string?> GenerateThumbnailAsync(string imagePath)"

      - id: TASK-MM-008
        name: Implement FileSystemMediaStorageService
        description: |
          Implement IMediaStorageService using file system storage in wwwroot/uploads/media.
          Organize files by year/month. Generate unique filenames. Create thumbnails for images.
        type: feature
        priority: CRITICAL
        assigned_to: backend-agent
        dependencies: [TASK-MM-007]
        effort_hours: 8
        parallel_safe: false
        files_created:
          - src/SurveyBot.Infrastructure/Services/FileSystemMediaStorageService.cs
        files_modified: []
        acceptance_criteria:
          - Files saved to wwwroot/uploads/media/{year}/{month}/{filename}
          - Filenames are unique (GUID-based or timestamp-based)
          - Thumbnails generated for images (200x200px)
          - Storage directories created automatically if missing
          - File permissions set correctly
          - All operations are async
          - Proper error handling and logging
        subtasks:
          - name: Implement SaveMediaAsync
            description: Save file to disk, generate thumbnail if image
          - name: Implement DeleteMediaAsync
            description: Delete file and thumbnail if exists
          - name: Implement GetMediaUrlAsync
            description: Return relative URL for web access
          - name: Implement thumbnail generation
            description: Use System.Drawing or ImageSharp for image processing
          - name: Add directory creation logic
            description: Ensure upload directories exist
          - name: Add logging
            description: Log all operations with structured logging

      - id: TASK-MM-009
        name: Create MediaValidationService
        description: |
          Create service in Infrastructure for validating uploaded media files.
          Validate file type, size, dimensions (images), duration (video/audio), content.
        type: feature
        priority: HIGH
        assigned_to: backend-agent
        dependencies: [TASK-MM-007]
        effort_hours: 5
        parallel_safe: true
        files_created:
          - src/SurveyBot.Infrastructure/Services/MediaValidationService.cs
          - src/SurveyBot.Core/Interfaces/IMediaValidationService.cs
        files_modified: []
        acceptance_criteria:
          - Validates file extension against allowed list
          - Validates file size against configured limits
          - Validates MIME type matches extension
          - Validates image dimensions (optional max width/height)
          - Returns detailed validation result with error messages
          - Prevents path traversal attacks
          - Prevents malicious file uploads
        subtasks:
          - name: Create IMediaValidationService interface
            description: Define ValidateAsync method
          - name: Implement file extension validation
            description: Check against allowed extensions list
          - name: Implement file size validation
            description: Check against configured max sizes
          - name: Implement MIME type validation
            description: Verify MIME type using file signature
          - name: Implement image dimension validation
            description: Read image metadata and check dimensions
          - name: Add security checks
            description: Prevent path traversal and executable uploads

      - id: TASK-MM-010
        name: Create MediaController with upload endpoint
        description: |
          Create MediaController in API layer with POST /api/media/upload endpoint.
          Accept multipart/form-data, validate, save media, return MediaItemDto.
        type: feature
        priority: CRITICAL
        assigned_to: backend-agent
        dependencies: [TASK-MM-008, TASK-MM-009]
        effort_hours: 6
        parallel_safe: false
        files_created:
          - src/SurveyBot.API/Controllers/MediaController.cs
        files_modified: []
        acceptance_criteria:
          - POST /api/media/upload accepts IFormFile
          - Endpoint requires authentication ([Authorize] attribute)
          - Validates file before saving
          - Returns 201 Created with MediaItemDto
          - Returns 400 Bad Request for validation errors
          - Returns 413 Payload Too Large for oversized files
          - Includes proper Swagger documentation
          - Handles errors gracefully with appropriate status codes
        subtasks:
          - name: Create MediaController class
            description: Inherit from ControllerBase, add [ApiController] and [Route]
          - name: Implement UploadMedia action
            description: "[HttpPost(\"upload\")] async Task<ActionResult<MediaItemDto>>"
          - name: Add file validation
            description: Call IMediaValidationService before saving
          - name: Add media storage
            description: Call IMediaStorageService to save file
          - name: Add error handling
            description: Try-catch with appropriate status codes
          - name: Add Swagger annotations
            description: Document request/response with examples

      - id: TASK-MM-011
        name: Add delete media endpoint
        description: |
          Add DELETE /api/media/{mediaId} endpoint to MediaController.
          Verify ownership, delete file from storage, update Question.MediaContent.
        type: feature
        priority: HIGH
        assigned_to: backend-agent
        dependencies: [TASK-MM-010]
        effort_hours: 4
        parallel_safe: false
        files_created: []
        files_modified:
          - src/SurveyBot.API/Controllers/MediaController.cs
        acceptance_criteria:
          - DELETE /api/media endpoint implemented
          - Verifies user owns the question containing the media
          - Deletes file from storage using IMediaStorageService
          - Updates Question.MediaContent to remove media reference
          - Returns 204 No Content on success
          - Returns 404 Not Found if media doesn't exist
          - Returns 403 Forbidden if user doesn't own media
          - Transaction ensures database and file system stay in sync
        subtasks:
          - name: Create DeleteMedia action
            description: "[HttpDelete(\"{mediaId}\")] async Task<IActionResult>"
          - name: Verify ownership
            description: Check user owns question containing media
          - name: Delete from storage
            description: Call IMediaStorageService.DeleteMediaAsync
          - name: Update database
            description: Remove media from Question.MediaContent JSON
          - name: Add transaction support
            description: Rollback if any step fails

      - id: TASK-MM-012
        name: Update QuestionDto to include MediaContent
        description: |
          Add MediaContent property to QuestionDto, QuestionCreateDto, QuestionUpdateDto.
          Update AutoMapper profiles to map MediaContent between entities and DTOs.
        type: feature
        priority: HIGH
        assigned_to: backend-agent
        dependencies: [TASK-MM-003]
        effort_hours: 3
        parallel_safe: true
        files_created: []
        files_modified:
          - src/SurveyBot.Core/DTOs/QuestionDto.cs
          - src/SurveyBot.Core/DTOs/CreateQuestionDto.cs
          - src/SurveyBot.Core/DTOs/UpdateQuestionDto.cs
          - src/SurveyBot.API/Mappings/MappingProfile.cs
        acceptance_criteria:
          - MediaContent property added to all Question DTOs
          - Property is MediaContentDto type (deserialized from JSON)
          - AutoMapper configured to map between JSON string and MediaContentDto
          - Mapping handles null MediaContent gracefully
          - Existing question API endpoints return MediaContent
          - DTOs maintain backward compatibility
        subtasks:
          - name: Add property to QuestionDto
            description: "public MediaContentDto? MediaContent { get; set; }"
          - name: Add property to CreateQuestionDto
            description: Optional MediaContent for creation
          - name: Add property to UpdateQuestionDto
            description: Optional MediaContent for updates
          - name: Update AutoMapper profile
            description: Add custom resolver for JSON serialization/deserialization

      - id: TASK-MM-013
        name: Register services in DI container
        description: |
          Register IMediaStorageService, IMediaValidationService in
          Infrastructure/DependencyInjection.cs with appropriate lifetimes.
        type: feature
        priority: HIGH
        assigned_to: backend-agent
        dependencies: [TASK-MM-008, TASK-MM-009]
        effort_hours: 1
        parallel_safe: false
        files_created: []
        files_modified:
          - src/SurveyBot.Infrastructure/DependencyInjection.cs
        acceptance_criteria:
          - IMediaStorageService registered as Scoped
          - IMediaValidationService registered as Scoped
          - Services available for dependency injection
          - No circular dependencies
          - Services resolve correctly at runtime
        subtasks:
          - name: Register IMediaStorageService
            description: "services.AddScoped<IMediaStorageService, FileSystemMediaStorageService>()"
          - name: Register IMediaValidationService
            description: "services.AddScoped<IMediaValidationService, MediaValidationService>()"
          - name: Test DI resolution
            description: Verify services can be injected into controllers

  # ============================================================================
  # PHASE 3: Frontend - Rich Text Editor & Media Picker (Week 3-4)
  # ============================================================================
  - name: Phase 3 - Frontend Rich Text Editor
    priority: HIGH
    description: Implement rich text editor with inline media support in React admin panel
    estimated_days: 7-10
    dependencies: [Phase 2 - Backend Media API]

    tasks:
      - id: TASK-MM-014
        name: Install react-quill and dependencies
        description: |
          Install react-quill (rich text editor), react-dropzone (file uploads),
          and any required image/video preview libraries in frontend project.
        type: setup
        priority: HIGH
        assigned_to: frontend-agent
        dependencies: [TASK-MM-012]
        effort_hours: 1
        parallel_safe: true
        files_created: []
        files_modified:
          - frontend/package.json
        acceptance_criteria:
          - react-quill@^2.0.0 installed
          - react-dropzone@^14.0.0 installed
          - quill-image-resize-module-react installed (optional)
          - Dependencies install without conflicts
          - TypeScript types available
        subtasks:
          - name: Run npm install
            description: "npm install react-quill react-dropzone"
          - name: Install types
            description: "npm install @types/react-quill --save-dev"
          - name: Verify installation
            description: Check node_modules and package.json

      - id: TASK-MM-015
        name: Create MediaPicker component
        description: |
          Create MediaPicker.tsx component for uploading and selecting media files.
          Support drag-and-drop, file browser, preview, and progress indication.
        type: feature
        priority: HIGH
        assigned_to: frontend-agent
        dependencies: [TASK-MM-014]
        effort_hours: 8
        parallel_safe: true
        files_created:
          - frontend/src/components/MediaPicker.tsx
          - frontend/src/components/MediaPreview.tsx
          - frontend/src/types/media.ts
        files_modified: []
        acceptance_criteria:
          - Drag-and-drop file upload interface
          - File browser fallback
          - Preview uploaded media (image, video, audio, document icon)
          - Upload progress bar
          - File size and type validation on client side
          - Error messages for invalid files
          - Returns MediaItemDto after successful upload
          - Accessible (keyboard navigation, screen reader support)
        subtasks:
          - name: Create MediaPicker component
            description: Use react-dropzone for file selection
          - name: Create MediaPreview component
            description: Display thumbnails and file info
          - name: Implement upload API call
            description: POST to /api/media/upload with FormData
          - name: Add progress tracking
            description: Show upload percentage
          - name: Add client-side validation
            description: Check file type and size before upload
          - name: Add error handling
            description: Display validation and upload errors

      - id: TASK-MM-016
        name: Create RichTextEditor component with media support
        description: |
          Create RichTextEditor.tsx wrapping react-quill with custom toolbar
          including media insert button. Integrate MediaPicker for uploads.
        type: feature
        priority: CRITICAL
        assigned_to: frontend-agent
        dependencies: [TASK-MM-015]
        effort_hours: 10
        parallel_safe: false
        files_created:
          - frontend/src/components/RichTextEditor.tsx
          - frontend/src/components/MediaToolbar.tsx
        files_modified: []
        acceptance_criteria:
          - ReactQuill component wrapped with custom configuration
          - Custom toolbar includes media insert button
          - Clicking media button opens MediaPicker modal
          - Uploaded media inserted at cursor position
          - Editor supports bold, italic, lists, links, and media
          - Editor content saved as HTML + MediaContent JSON separately
          - Editor displays existing media correctly on edit
          - Editor is responsive and mobile-friendly
        subtasks:
          - name: Create RichTextEditor wrapper
            description: Configure ReactQuill with custom modules
          - name: Create custom toolbar
            description: Add media insert button to toolbar
          - name: Integrate MediaPicker
            description: Show MediaPicker modal on button click
          - name: Implement media insertion
            description: Insert media reference into editor content
          - name: Handle content extraction
            description: Separate HTML content and media metadata
          - name: Test on mobile devices
            description: Verify touch interactions work

      - id: TASK-MM-017
        name: Create MediaGallery component
        description: |
          Create MediaGallery.tsx to display all media attached to a question
          in a grid layout with options to add, remove, or reorder media.
        type: feature
        priority: MEDIUM
        assigned_to: frontend-agent
        dependencies: [TASK-MM-015]
        effort_hours: 6
        parallel_safe: true
        files_created:
          - frontend/src/components/MediaGallery.tsx
          - frontend/src/components/MediaGalleryItem.tsx
        files_modified: []
        acceptance_criteria:
          - Grid layout displays all media thumbnails
          - Add media button opens MediaPicker
          - Delete button on each media item
          - Drag-and-drop to reorder media
          - Media items show file name, size, type
          - Click media item to view full size (lightbox)
          - Responsive grid (1 column mobile, 3 columns desktop)
        subtasks:
          - name: Create gallery grid layout
            description: CSS Grid or Flexbox responsive layout
          - name: Create gallery item component
            description: Thumbnail with metadata and actions
          - name: Implement add media
            description: Integrate MediaPicker
          - name: Implement delete media
            description: Call DELETE /api/media/{id}
          - name: Implement reordering
            description: Drag-and-drop with react-beautiful-dnd or native
          - name: Add lightbox viewer
            description: Full-screen media viewer on click

      - id: TASK-MM-018
        name: Update QuestionForm to use RichTextEditor
        description: |
          Replace plain text input in QuestionForm with RichTextEditor component.
          Update form submission to include MediaContent JSON.
        type: feature
        priority: CRITICAL
        assigned_to: frontend-agent
        dependencies: [TASK-MM-016]
        effort_hours: 5
        parallel_safe: false
        files_created: []
        files_modified:
          - frontend/src/components/QuestionForm.tsx
          - frontend/src/pages/CreateSurvey.tsx
          - frontend/src/pages/EditSurvey.tsx
        acceptance_criteria:
          - QuestionForm uses RichTextEditor instead of textarea
          - Form submission includes QuestionText and MediaContent
          - MediaContent serialized to JSON correctly
          - Existing questions load correctly in editor
          - Validation works for both text and media
          - Save button disabled until content is valid
          - Form maintains backward compatibility with plain text questions
        subtasks:
          - name: Replace textarea with RichTextEditor
            description: Update QuestionForm component
          - name: Update form state management
            description: Track both text and media content
          - name: Update form submission
            description: Include MediaContent in API request
          - name: Update form validation
            description: Validate rich text is not empty
          - name: Test with existing questions
            description: Verify plain text questions still work

      - id: TASK-MM-019
        name: Update QuestionDisplay to render rich content
        description: |
          Update QuestionDisplay component to render HTML content from rich text editor
          and display embedded media inline. Used for survey preview and taking surveys.
        type: feature
        priority: HIGH
        assigned_to: frontend-agent
        dependencies: [TASK-MM-016]
        effort_hours: 4
        parallel_safe: true
        files_created:
          - frontend/src/components/RichContentRenderer.tsx
        files_modified:
          - frontend/src/components/QuestionDisplay.tsx
        acceptance_criteria:
          - Renders HTML content safely (sanitized)
          - Displays embedded media at correct positions
          - Images are responsive and lazy-loaded
          - Videos have playback controls
          - Audio has playback controls
          - Documents show download link
          - Content is accessible (alt text, captions)
          - Works in survey preview and response collection
        subtasks:
          - name: Create RichContentRenderer
            description: Component to safely render HTML + media
          - name: Implement HTML sanitization
            description: Use DOMPurify or similar to prevent XSS
          - name: Implement media rendering
            description: Render img, video, audio tags with controls
          - name: Add responsive image handling
            description: Srcset for different screen sizes
          - name: Add lazy loading
            description: Load media only when visible
          - name: Update QuestionDisplay
            description: Use RichContentRenderer instead of plain text

      - id: TASK-MM-020
        name: Add media management to survey builder UI
        description: |
          Add MediaGallery component to survey builder interface.
          Allow survey creators to manage media for each question.
        type: feature
        priority: MEDIUM
        assigned_to: frontend-agent
        dependencies: [TASK-MM-017, TASK-MM-018]
        effort_hours: 4
        parallel_safe: false
        files_created: []
        files_modified:
          - frontend/src/pages/CreateSurvey.tsx
          - frontend/src/pages/EditSurvey.tsx
          - frontend/src/components/QuestionBuilder.tsx
        acceptance_criteria:
          - MediaGallery appears below QuestionText editor
          - Users can add multiple media to each question
          - Users can reorder media within a question
          - Users can delete media from a question
          - Changes save to backend correctly
          - UI updates optimistically during operations
          - Error messages shown for failed operations
        subtasks:
          - name: Add MediaGallery to QuestionBuilder
            description: Place below RichTextEditor
          - name: Wire up add media functionality
            description: Connect to MediaPicker and API
          - name: Wire up delete functionality
            description: Call DELETE endpoint with confirmation
          - name: Wire up reorder functionality
            description: Update MediaContent order in state
          - name: Add optimistic UI updates
            description: Update UI immediately, rollback on error
          - name: Add error handling
            description: Toast notifications for errors

  # ============================================================================
  # PHASE 4: Telegram Bot Integration (Week 4-5)
  # ============================================================================
  - name: Phase 4 - Telegram Bot Media Support
    priority: HIGH
    description: Update Telegram bot to display media in questions and handle media responses
    estimated_days: 5-7
    dependencies: [Phase 2 - Backend Media API]

    tasks:
      - id: TASK-MM-021
        name: Create TelegramMediaService
        description: |
          Create service to handle media operations in Telegram bot context.
          Methods: SendMediaAsync, GetMediaCaptionAsync, FormatMediaMessageAsync.
        type: feature
        priority: HIGH
        assigned_to: bot-agent
        dependencies: [TASK-MM-012]
        effort_hours: 4
        parallel_safe: true
        files_created:
          - src/SurveyBot.Bot/Services/TelegramMediaService.cs
          - src/SurveyBot.Core/Interfaces/ITelegramMediaService.cs
        files_modified: []
        acceptance_criteria:
          - Service can send images via Telegram Bot API
          - Service can send videos via Telegram Bot API
          - Service can send audio via Telegram Bot API
          - Service can send documents via Telegram Bot API
          - Service formats media captions with question text
          - Service handles media send failures gracefully
          - Service logs all media operations
        subtasks:
          - name: Create ITelegramMediaService interface
            description: Define SendMediaAsync and helper methods
          - name: Implement image sending
            description: Use ITelegramBotClient.SendPhotoAsync
          - name: Implement video sending
            description: Use ITelegramBotClient.SendVideoAsync
          - name: Implement audio sending
            description: Use ITelegramBotClient.SendAudioAsync
          - name: Implement document sending
            description: Use ITelegramBotClient.SendDocumentAsync
          - name: Add caption formatting
            description: Include question text as media caption
          - name: Add error handling
            description: Catch and log Telegram API errors

      - id: TASK-MM-022
        name: Update QuestionHandler to send media
        description: |
          Update question presentation logic in bot to send media before/with question text.
          Handle multiple media items per question.
        type: feature
        priority: HIGH
        assigned_to: bot-agent
        dependencies: [TASK-MM-021]
        effort_hours: 6
        parallel_safe: false
        files_created: []
        files_modified:
          - src/SurveyBot.Bot/Handlers/QuestionHandler.cs
        acceptance_criteria:
          - Bot sends all media items before showing question
          - Media sent in order specified in MediaContent
          - Question text sent after media as caption or separate message
          - Bot handles questions without media (backward compatible)
          - Bot handles mixed content (text + media)
          - Bot retries failed media sends (configurable retries)
          - User sees clear question even if media fails
        subtasks:
          - name: Parse MediaContent JSON
            description: Deserialize MediaContent from Question
          - name: Send media items
            description: Loop through media and send each
          - name: Handle send failures
            description: Continue to question even if media fails
          - name: Add retry logic
            description: Retry failed media sends up to 3 times
          - name: Format question message
            description: Send question text after media
          - name: Test with various media types
            description: Verify images, videos, audio, documents work

      - id: TASK-MM-023
        name: Update survey preview command to show media
        description: |
          Update /preview command in bot to show media when displaying survey questions.
          Show media count and types in preview.
        type: feature
        priority: MEDIUM
        assigned_to: bot-agent
        dependencies: [TASK-MM-022]
        effort_hours: 3
        parallel_safe: false
        files_created: []
        files_modified:
          - src/SurveyBot.Bot/Commands/PreviewCommand.cs
        acceptance_criteria:
          - Preview shows media count per question
          - Preview indicates media types (image, video, etc)
          - Preview optionally sends first media item
          - Preview maintains current text-based overview
          - Preview loads quickly despite media content
        subtasks:
          - name: Parse MediaContent in preview
            description: Count media items per question
          - name: Display media indicators
            description: "Question 1: 2 images, 1 video"
          - name: Add media preview option
            description: Optional flag to send actual media
          - name: Optimize preview performance
            description: Avoid loading media files during preview

      - id: TASK-MM-024
        name: Add media upload command for bot users
        description: |
          Add /addmedia command allowing users to upload media through Telegram bot
          and attach to their questions during survey creation.
        type: feature
        priority: LOW
        assigned_to: bot-agent
        dependencies: [TASK-MM-021]
        effort_hours: 8
        parallel_safe: true
        files_created:
          - src/SurveyBot.Bot/Commands/AddMediaCommand.cs
        files_modified:
          - src/SurveyBot.Bot/BotService.cs
        acceptance_criteria:
          - /addmedia command downloads media from Telegram
          - Bot saves media to file system via IMediaStorageService
          - Bot updates question MediaContent via API
          - Bot confirms successful media attachment
          - Bot handles media size limits (Telegram + app limits)
          - Bot validates media type before accepting
          - Command works during survey creation flow
        subtasks:
          - name: Create AddMediaCommand handler
            description: Handle /addmedia command
          - name: Implement media download from Telegram
            description: Use GetFileAsync and download stream
          - name: Validate media
            description: Check type and size before saving
          - name: Save to storage
            description: Call IMediaStorageService.SaveMediaAsync
          - name: Update question via API
            description: PATCH question to add media to MediaContent
          - name: Send confirmation
            description: Notify user of successful attachment

      - id: TASK-MM-025
        name: Test bot media handling end-to-end
        description: |
          Comprehensive testing of Telegram bot media features.
          Test all media types, error scenarios, and user flows.
        type: test
        priority: HIGH
        assigned_to: bot-agent
        dependencies: [TASK-MM-022, TASK-MM-023, TASK-MM-024]
        effort_hours: 6
        parallel_safe: true
        files_created:
          - tests/SurveyBot.Bot.Tests/MediaHandlingTests.cs
        files_modified: []
        acceptance_criteria:
          - All media types display correctly in bot (image, video, audio, document)
          - Questions with multiple media items work
          - Questions without media work (backward compatibility)
          - Media send failures handled gracefully
          - /addmedia command tested with various file types
          - Performance acceptable with large media files
          - No memory leaks from media streams
        subtasks:
          - name: Test image display
            description: Send survey with image questions
          - name: Test video display
            description: Send survey with video questions
          - name: Test audio display
            description: Send survey with audio questions
          - name: Test document display
            description: Send survey with document questions
          - name: Test multiple media
            description: Question with 3+ media items
          - name: Test error handling
            description: Simulate Telegram API failures
          - name: Test /addmedia command
            description: Upload media through bot
          - name: Load testing
            description: Test with 10MB+ media files

  # ============================================================================
  # PHASE 5: Testing & Quality Assurance (Week 5-6)
  # ============================================================================
  - name: Phase 5 - Testing & QA
    priority: HIGH
    description: Comprehensive testing of multimedia features across all layers
    estimated_days: 5-7
    dependencies: [Phase 3 - Frontend Rich Text Editor, Phase 4 - Telegram Bot Media Support]

    tasks:
      - id: TASK-MM-026
        name: Write unit tests for MediaContentHelper
        description: |
          Unit tests for MediaContentHelper utility class in Core layer.
          Test serialization, deserialization, validation, add/remove operations.
        type: test
        priority: HIGH
        assigned_to: testing-agent
        dependencies: [TASK-MM-006]
        effort_hours: 4
        parallel_safe: true
        files_created:
          - tests/SurveyBot.Core.Tests/Utilities/MediaContentHelperTests.cs
        files_modified: []
        acceptance_criteria:
          - Test successful serialization of MediaContentDto to JSON
          - Test successful deserialization of JSON to MediaContentDto
          - Test validation of valid MediaContent structure
          - Test validation rejection of invalid structure
          - Test AddMediaItem adds to existing content
          - Test RemoveMediaItem removes correct item
          - Test null handling in all methods
          - Test edge cases (empty media list, missing fields)
          - Minimum 80% code coverage for MediaContentHelper
        subtasks:
          - name: Create test class
            description: MediaContentHelperTests with test fixtures
          - name: Test serialization
            description: Verify JSON output format
          - name: Test deserialization
            description: Verify object construction from JSON
          - name: Test validation
            description: Valid and invalid schemas
          - name: Test add/remove
            description: Manipulate media items
          - name: Test error cases
            description: Null inputs, malformed JSON

      - id: TASK-MM-027
        name: Write unit tests for MediaStorageService
        description: |
          Unit tests for FileSystemMediaStorageService.
          Mock file system operations, test save/delete/get methods.
        type: test
        priority: HIGH
        assigned_to: testing-agent
        dependencies: [TASK-MM-008]
        effort_hours: 6
        parallel_safe: true
        files_created:
          - tests/SurveyBot.Infrastructure.Tests/Services/MediaStorageServiceTests.cs
        files_modified: []
        acceptance_criteria:
          - Test SaveMediaAsync creates file at correct path
          - Test SaveMediaAsync generates unique filename
          - Test SaveMediaAsync creates thumbnail for images
          - Test DeleteMediaAsync removes file and thumbnail
          - Test GetMediaUrlAsync returns correct URL
          - Test directory creation when missing
          - Test error handling for I/O exceptions
          - Use mocked file system (System.IO.Abstractions)
          - Minimum 80% code coverage
        subtasks:
          - name: Create test class with mocks
            description: Mock IFileSystem for testing
          - name: Test SaveMediaAsync
            description: Verify file save operations
          - name: Test DeleteMediaAsync
            description: Verify file delete operations
          - name: Test GetMediaUrlAsync
            description: Verify URL generation
          - name: Test thumbnail generation
            description: Verify image processing
          - name: Test error scenarios
            description: Disk full, permission denied, etc

      - id: TASK-MM-028
        name: Write unit tests for MediaValidationService
        description: |
          Unit tests for MediaValidationService.
          Test all validation rules: type, size, MIME, dimensions, security.
        type: test
        priority: HIGH
        assigned_to: testing-agent
        dependencies: [TASK-MM-009]
        effort_hours: 5
        parallel_safe: true
        files_created:
          - tests/SurveyBot.Infrastructure.Tests/Services/MediaValidationServiceTests.cs
        files_modified: []
        acceptance_criteria:
          - Test allowed file extensions pass validation
          - Test disallowed file extensions fail validation
          - Test file size within limit passes
          - Test file size exceeding limit fails
          - Test MIME type validation
          - Test path traversal attack prevention
          - Test malicious file detection (executable extensions)
          - Test image dimension validation
          - All validation error messages are clear
          - Minimum 85% code coverage
        subtasks:
          - name: Create test class
            description: MediaValidationServiceTests with test data
          - name: Test extension validation
            description: Valid and invalid extensions
          - name: Test size validation
            description: Within and over limits
          - name: Test MIME validation
            description: Matching and mismatched types
          - name: Test security checks
            description: Path traversal, executables
          - name: Test dimension validation
            description: Image width/height limits

      - id: TASK-MM-029
        name: Write integration tests for media API endpoints
        description: |
          Integration tests for MediaController endpoints.
          Test upload, delete, authorization, error handling.
        type: test
        priority: HIGH
        assigned_to: testing-agent
        dependencies: [TASK-MM-010, TASK-MM-011]
        effort_hours: 7
        parallel_safe: true
        files_created:
          - tests/SurveyBot.API.Tests/Controllers/MediaControllerTests.cs
        files_modified: []
        acceptance_criteria:
          - Test POST /api/media/upload with valid file returns 201
          - Test POST /api/media/upload with invalid file returns 400
          - Test POST /api/media/upload without auth returns 401
          - Test POST /api/media/upload with oversized file returns 413
          - Test DELETE /api/media/{id} with ownership returns 204
          - Test DELETE /api/media/{id} without ownership returns 403
          - Test DELETE /api/media/{id} non-existent returns 404
          - Use WebApplicationFactory for integration testing
          - Test with actual file uploads (test files)
          - Minimum 75% code coverage for MediaController
        subtasks:
          - name: Setup test infrastructure
            description: WebApplicationFactory, test database
          - name: Test successful upload
            description: Upload image and verify response
          - name: Test upload validation
            description: Invalid file types and sizes
          - name: Test upload authorization
            description: Unauthenticated and authenticated requests
          - name: Test successful delete
            description: Delete owned media
          - name: Test delete authorization
            description: Delete media owned by another user
          - name: Test delete non-existent
            description: Delete media that doesn't exist

      - id: TASK-MM-030
        name: Write frontend component tests
        description: |
          Unit and integration tests for React components.
          Test MediaPicker, RichTextEditor, MediaGallery, QuestionForm.
        type: test
        priority: MEDIUM
        assigned_to: testing-agent
        dependencies: [TASK-MM-015, TASK-MM-016, TASK-MM-017, TASK-MM-018]
        effort_hours: 8
        parallel_safe: true
        files_created:
          - frontend/src/components/__tests__/MediaPicker.test.tsx
          - frontend/src/components/__tests__/RichTextEditor.test.tsx
          - frontend/src/components/__tests__/MediaGallery.test.tsx
          - frontend/src/components/__tests__/QuestionForm.test.tsx
        files_modified: []
        acceptance_criteria:
          - MediaPicker tests file selection and upload
          - MediaPicker tests drag-and-drop
          - MediaPicker tests validation errors
          - RichTextEditor tests content editing
          - RichTextEditor tests media insertion
          - MediaGallery tests add/delete/reorder
          - QuestionForm tests form submission with media
          - Use React Testing Library and Jest
          - Mock API calls with MSW (Mock Service Worker)
          - Minimum 70% component coverage
        subtasks:
          - name: Setup testing infrastructure
            description: Configure Jest, RTL, MSW
          - name: Test MediaPicker
            description: File selection, upload, validation
          - name: Test RichTextEditor
            description: Text editing, media insertion
          - name: Test MediaGallery
            description: Display, add, delete, reorder
          - name: Test QuestionForm
            description: Form submission with MediaContent
          - name: Mock API endpoints
            description: Use MSW to mock media upload/delete

      - id: TASK-MM-031
        name: End-to-end testing with Playwright
        description: |
          E2E tests covering complete user workflows with media.
          Test survey creation with media, taking survey with media, viewing results.
        type: test
        priority: MEDIUM
        assigned_to: testing-agent
        dependencies: [TASK-MM-018, TASK-MM-019, TASK-MM-020]
        effort_hours: 10
        parallel_safe: true
        files_created:
          - tests/E2E/media-workflows.spec.ts
          - tests/E2E/fixtures/test-image.jpg
          - tests/E2E/fixtures/test-video.mp4
        files_modified: []
        acceptance_criteria:
          - Test creating survey with image question
          - Test creating survey with video question
          - Test creating survey with multiple media per question
          - Test editing survey to add/remove media
          - Test taking survey with media questions
          - Test viewing survey results with media
          - Test media deletion workflow
          - All tests pass in CI/CD pipeline
          - Tests run in headless and headed mode
        subtasks:
          - name: Setup Playwright
            description: Install and configure Playwright
          - name: Create test fixtures
            description: Sample media files for testing
          - name: Test survey creation
            description: Create survey with media via UI
          - name: Test survey editing
            description: Add/remove media from existing survey
          - name: Test survey taking
            description: View and respond to media questions
          - name: Test results viewing
            description: View responses with media context
          - name: Setup CI/CD integration
            description: Add E2E tests to GitHub Actions

      - id: TASK-MM-032
        name: Performance testing for media operations
        description: |
          Load and performance testing for media upload, storage, and retrieval.
          Test concurrent uploads, large files, many media items per question.
        type: test
        priority: MEDIUM
        assigned_to: testing-agent
        dependencies: [TASK-MM-008, TASK-MM-010]
        effort_hours: 6
        parallel_safe: true
        files_created:
          - tests/Performance/MediaPerformanceTests.cs
        files_modified: []
        acceptance_criteria:
          - Test concurrent media uploads (10+ simultaneous)
          - Test large file uploads (up to max size limit)
          - Test question with 10+ media items
          - Test survey with 50+ questions with media
          - Measure upload time for various file sizes
          - Measure page load time with media content
          - Identify performance bottlenecks
          - Document performance benchmarks
        subtasks:
          - name: Setup performance test framework
            description: Use BenchmarkDotNet or similar
          - name: Test concurrent uploads
            description: Simulate multiple users uploading
          - name: Test large files
            description: Upload max-size media files
          - name: Test many media items
            description: Question with 15 media items
          - name: Test large survey
            description: Survey with 100 questions, each with media
          - name: Profile and optimize
            description: Identify and fix bottlenecks
          - name: Document benchmarks
            description: Record baseline performance metrics

      - id: TASK-MM-033
        name: Security testing for media features
        description: |
          Security-focused testing for media upload and storage.
          Test path traversal, malicious files, XSS, authorization bypass.
        type: test
        priority: HIGH
        assigned_to: testing-agent
        dependencies: [TASK-MM-009, TASK-MM-010]
        effort_hours: 5
        parallel_safe: true
        files_created:
          - tests/Security/MediaSecurityTests.cs
        files_modified: []
        acceptance_criteria:
          - Test path traversal prevention (../../../etc/passwd)
          - Test executable file rejection (.exe, .sh, .bat)
          - Test MIME type spoofing detection
          - Test XSS via filename or content
          - Test authorization bypass attempts
          - Test file size limit enforcement
          - Test malformed multipart uploads
          - All security tests pass
          - Document security findings
        subtasks:
          - name: Test path traversal
            description: Attempt directory traversal in filenames
          - name: Test executable upload
            description: Attempt to upload executables
          - name: Test MIME spoofing
            description: File with mismatched extension and MIME type
          - name: Test XSS in filenames
            description: Filenames with script tags
          - name: Test authorization
            description: Access/delete media without permission
          - name: Test size limits
            description: Upload files exceeding limits
          - name: Test malformed uploads
            description: Corrupted multipart data

  # ============================================================================
  # PHASE 6: Documentation & Migration Support (Week 6)
  # ============================================================================
  - name: Phase 6 - Documentation & Migration
    priority: MEDIUM
    description: Create documentation and migration tools for multimedia feature
    estimated_days: 3-4
    dependencies: [Phase 5 - Testing & QA]

    tasks:
      - id: TASK-MM-034
        name: Update API documentation (Swagger)
        description: |
          Update Swagger documentation for new MediaController endpoints.
          Add examples for media upload requests and responses.
        type: documentation
        priority: MEDIUM
        assigned_to: backend-agent
        dependencies: [TASK-MM-010, TASK-MM-011]
        effort_hours: 3
        parallel_safe: true
        files_created: []
        files_modified:
          - src/SurveyBot.API/Controllers/MediaController.cs
        acceptance_criteria:
          - All MediaController endpoints documented in Swagger
          - Request examples show multipart/form-data format
          - Response examples show MediaItemDto structure
          - Error responses documented (400, 401, 403, 413)
          - File upload parameters documented
          - Swagger UI allows testing media upload
        subtasks:
          - name: Add XML comments
            description: Comprehensive XML docs for all actions
          - name: Add [ProducesResponseType] attributes
            description: Document all possible response types
          - name: Add example values
            description: Use [SwaggerSchema] for examples
          - name: Test in Swagger UI
            description: Verify upload works through Swagger

      - id: TASK-MM-035
        name: Create developer documentation
        description: |
          Write comprehensive developer docs for multimedia feature.
          Cover architecture, usage, extension points, best practices.
        type: documentation
        priority: MEDIUM
        assigned_to: project-manager
        dependencies: [TASK-MM-033]
        effort_hours: 6
        parallel_safe: true
        files_created:
          - docs/multimedia-support.md
          - docs/media-api-guide.md
          - docs/frontend-media-components.md
        files_modified:
          - CLAUDE.md
          - src/SurveyBot.Core/CLAUDE.md
          - src/SurveyBot.Infrastructure/CLAUDE.md
          - src/SurveyBot.API/CLAUDE.md
          - frontend/CLAUDE.md
        acceptance_criteria:
          - Architecture overview with diagrams
          - MediaContent JSON schema documented
          - API usage examples (upload, delete)
          - Frontend component usage examples
          - Configuration options documented
          - Security considerations documented
          - Performance tips documented
          - Troubleshooting guide included
        subtasks:
          - name: Create architecture overview
            description: Diagram showing media flow through layers
          - name: Document MediaContent schema
            description: Schema structure with examples
          - name: Write API guide
            description: How to use media endpoints
          - name: Write frontend guide
            description: How to use RichTextEditor and MediaPicker
          - name: Document configuration
            description: All config options with defaults
          - name: Write troubleshooting guide
            description: Common issues and solutions

      - id: TASK-MM-036
        name: Create user documentation
        description: |
          Write end-user documentation for adding media to surveys.
          Cover web admin panel and Telegram bot workflows.
        type: documentation
        priority: LOW
        assigned_to: project-manager
        dependencies: [TASK-MM-035]
        effort_hours: 4
        parallel_safe: true
        files_created:
          - docs/user-guide-multimedia.md
          - docs/faq-multimedia.md
        files_modified: []
        acceptance_criteria:
          - Step-by-step guide for adding media via web
          - Step-by-step guide for adding media via bot
          - Supported media types listed
          - File size limits documented
          - Best practices for media (image resolution, video format)
          - FAQ covering common questions
          - Screenshots or GIFs demonstrating workflows
        subtasks:
          - name: Write web interface guide
            description: How to add media in admin panel
          - name: Write Telegram bot guide
            description: How to add media via /addmedia command
          - name: Document supported formats
            description: List all supported types and extensions
          - name: Document limits
            description: File size and dimension limits
          - name: Write best practices
            description: Recommended formats and sizes
          - name: Create FAQ
            description: Answer common questions
          - name: Add visual aids
            description: Screenshots or animated GIFs

      - id: TASK-MM-037
        name: Create database migration guide
        description: |
          Document database migration process for adding MediaContent column.
          Include backup procedures and rollback steps.
        type: documentation
        priority: HIGH
        assigned_to: database-agent
        dependencies: [TASK-MM-005]
        effort_hours: 2
        parallel_safe: true
        files_created:
          - docs/migration-guide-multimedia.md
        files_modified: []
        acceptance_criteria:
          - Pre-migration checklist documented
          - Backup procedure documented
          - Migration command documented
          - Verification steps documented
          - Rollback procedure documented
          - Expected downtime documented
          - Post-migration testing steps
        subtasks:
          - name: Document pre-migration steps
            description: Backup, verification, prerequisites
          - name: Document migration execution
            description: Exact commands to run
          - name: Document verification
            description: How to verify migration success
          - name: Document rollback
            description: How to rollback if issues occur
          - name: Estimate downtime
            description: Expected time for migration

      - id: TASK-MM-038
        name: Create configuration examples
        description: |
          Create example configuration files for different deployment scenarios.
          Include development, staging, production configs.
        type: documentation
        priority: LOW
        assigned_to: backend-agent
        dependencies: [TASK-MM-013]
        effort_hours: 2
        parallel_safe: true
        files_created:
          - config-examples/appsettings.Media.Development.json
          - config-examples/appsettings.Media.Production.json
          - config-examples/docker-compose.media.yml
        files_modified:
          - src/SurveyBot.API/appsettings.json
          - src/SurveyBot.API/appsettings.Development.json
        acceptance_criteria:
          - Development config with local file storage
          - Production config with optimized settings
          - Docker compose with volume mounts for media
          - Configuration comments explain each setting
          - Security-sensitive defaults used
        subtasks:
          - name: Create dev config
            description: Local storage, verbose logging
          - name: Create prod config
            description: Optimized storage, minimal logging
          - name: Create Docker config
            description: Volume mounts for persistent storage
          - name: Add comments
            description: Explain each configuration option

  # ============================================================================
  # PHASE 7: Deployment & Optimization (Week 6+)
  # ============================================================================
  - name: Phase 7 - Deployment & Optimization
    priority: MEDIUM
    description: Deploy multimedia feature and optimize performance
    estimated_days: 3-5
    dependencies: [Phase 6 - Documentation & Migration]

    tasks:
      - id: TASK-MM-039
        name: Configure production media storage
        description: |
          Setup production media storage directory with proper permissions.
          Configure web server to serve static media files efficiently.
        type: deployment
        priority: HIGH
        assigned_to: devops-agent
        dependencies: [TASK-MM-008]
        effort_hours: 4
        parallel_safe: true
        files_created:
          - deploy/setup-media-storage.sh
        files_modified:
          - docker-compose.yml
        acceptance_criteria:
          - Media storage directory created with correct permissions
          - Web server configured to serve /uploads/media/* efficiently
          - Directory permissions prevent unauthorized access
          - Automatic cleanup for old media files (optional)
          - Backup strategy for media files documented
          - Volume mounts configured in Docker
        subtasks:
          - name: Create storage directory
            description: mkdir -p /var/www/surveybot/uploads/media
          - name: Set permissions
            description: chown and chmod for web server user
          - name: Configure nginx/Apache
            description: Static file serving for /uploads/media
          - name: Add volume to Docker
            description: Mount host directory to container
          - name: Setup backup
            description: Include media in backup strategy

      - id: TASK-MM-040
        name: Implement image optimization pipeline
        description: |
          Add automatic image optimization during upload.
          Compress images, generate responsive sizes, create WebP versions.
        type: optimization
        priority: MEDIUM
        assigned_to: backend-agent
        dependencies: [TASK-MM-008]
        effort_hours: 6
        parallel_safe: true
        files_created:
          - src/SurveyBot.Infrastructure/Services/ImageOptimizationService.cs
          - src/SurveyBot.Core/Interfaces/IImageOptimizationService.cs
        files_modified:
          - src/SurveyBot.Infrastructure/Services/FileSystemMediaStorageService.cs
        acceptance_criteria:
          - Images compressed during upload (reduce size by 30-50%)
          - Multiple sizes generated (thumbnail, medium, large)
          - WebP format generated for modern browsers
          - EXIF data stripped for privacy and size
          - Optimization is async and doesn't block upload
          - Original image preserved
        subtasks:
          - name: Create IImageOptimizationService
            description: Define optimization interface
          - name: Implement compression
            description: Use ImageSharp to compress images
          - name: Generate responsive sizes
            description: Create 200px, 600px, 1200px versions
          - name: Generate WebP
            description: Create WebP version for each size
          - name: Strip EXIF
            description: Remove metadata from images
          - name: Integrate with upload
            description: Call optimization after file save

      - id: TASK-MM-041
        name: Implement CDN integration (optional)
        description: |
          Add support for serving media from CDN (CloudFlare, AWS CloudFront).
          Configure URL generation to use CDN domain.
        type: feature
        priority: LOW
        assigned_to: backend-agent
        dependencies: [TASK-MM-008]
        effort_hours: 5
        parallel_safe: true
        files_created:
          - src/SurveyBot.Infrastructure/Services/CdnMediaStorageService.cs
        files_modified:
          - src/SurveyBot.API/appsettings.json
        acceptance_criteria:
          - Configuration option to enable CDN
          - GetMediaUrlAsync returns CDN URL when enabled
          - CDN purge/invalidation supported
          - Fallback to local storage if CDN unavailable
          - Documentation for CDN setup
        subtasks:
          - name: Add CDN configuration
            description: CdnEnabled, CdnBaseUrl in appsettings
          - name: Update GetMediaUrlAsync
            description: Return CDN URL when enabled
          - name: Implement cache invalidation
            description: Purge CDN cache on media delete
          - name: Add fallback logic
            description: Use local URLs if CDN fails
          - name: Document CDN setup
            description: Guide for CloudFlare/AWS setup

      - id: TASK-MM-042
        name: Setup monitoring and logging for media operations
        description: |
          Add structured logging and monitoring for media operations.
          Track upload success rate, file sizes, errors, performance.
        type: feature
        priority: MEDIUM
        assigned_to: backend-agent
        dependencies: [TASK-MM-008, TASK-MM-010]
        effort_hours: 4
        parallel_safe: true
        files_created: []
        files_modified:
          - src/SurveyBot.Infrastructure/Services/FileSystemMediaStorageService.cs
          - src/SurveyBot.API/Controllers/MediaController.cs
        acceptance_criteria:
          - All media operations logged with structured data
          - Upload success/failure metrics tracked
          - File size statistics logged
          - Error rates monitored
          - Performance metrics logged (upload duration)
          - Logs include user context and media metadata
          - Integration with application insights or similar
        subtasks:
          - name: Add structured logging
            description: Use Serilog with enrichment
          - name: Log upload events
            description: Track successful and failed uploads
          - name: Log file metadata
            description: Size, type, dimensions
          - name: Log performance
            description: Upload duration, processing time
          - name: Add error tracking
            description: Log all exceptions with context
          - name: Create dashboards
            description: Visualize metrics in monitoring tool

      - id: TASK-MM-043
        name: Implement media cleanup job
        description: |
          Create background job to clean up orphaned media files.
          Remove media files not referenced in any Question.MediaContent.
        type: feature
        priority: LOW
        assigned_to: backend-agent
        dependencies: [TASK-MM-008]
        effort_hours: 5
        parallel_safe: true
        files_created:
          - src/SurveyBot.Infrastructure/BackgroundJobs/MediaCleanupJob.cs
        files_modified: []
        acceptance_criteria:
          - Job runs on schedule (daily/weekly)
          - Identifies media files not in database
          - Deletes files older than retention period (e.g., 30 days)
          - Logs cleanup operations
          - Respects configured retention policy
          - Can be triggered manually
          - Safe mode (dry run) for testing
        subtasks:
          - name: Create MediaCleanupJob class
            description: Background job using IHostedService
          - name: Implement orphan detection
            description: Find files not in MediaContent
          - name: Implement file deletion
            description: Delete orphaned files
          - name: Add retention policy
            description: Configure days to keep orphaned files
          - name: Add logging
            description: Log deleted files and stats
          - name: Add dry run mode
            description: Report what would be deleted

      - id: TASK-MM-044
        name: Performance optimization - lazy loading
        description: |
          Implement lazy loading for media content in API responses.
          Don't load MediaContent by default, require explicit opt-in.
        type: optimization
        priority: MEDIUM
        assigned_to: backend-agent
        dependencies: [TASK-MM-012]
        effort_hours: 3
        parallel_safe: true
        files_created: []
        files_modified:
          - src/SurveyBot.API/Controllers/QuestionsController.cs
          - src/SurveyBot.API/Controllers/SurveysController.cs
        acceptance_criteria:
          - MediaContent not loaded by default in list endpoints
          - Query parameter includeMedia to opt-in to media loading
          - Reduces payload size for question lists by 50-80%
          - Detail endpoints include media by default
          - Backward compatible with existing API clients
        subtasks:
          - name: Add includeMedia parameter
            description: Optional bool parameter on GET endpoints
          - name: Conditional media loading
            description: Load MediaContent only if requested
          - name: Update DTOs
            description: MediaContent nullable in list DTOs
          - name: Test payload size
            description: Measure reduction in response size
          - name: Update API documentation
            description: Document includeMedia parameter

  # ============================================================================
  # PHASE 8: Final Integration & Release (Week 6+)
  # ============================================================================
  - name: Phase 8 - Final Integration & Release
    priority: HIGH
    description: Final testing, bug fixes, and release preparation
    estimated_days: 3-4
    dependencies: [Phase 7 - Deployment & Optimization]

    tasks:
      - id: TASK-MM-045
        name: Integration testing across all layers
        description: |
          Comprehensive integration testing of multimedia feature across
          frontend, backend API, database, and Telegram bot.
        type: test
        priority: HIGH
        assigned_to: testing-agent
        dependencies: [TASK-MM-044]
        effort_hours: 8
        parallel_safe: true
        files_created:
          - tests/Integration/MultimediaIntegrationTests.cs
        files_modified: []
        acceptance_criteria:
          - Test complete workflow: create survey with media via web
          - Test complete workflow: take survey with media via bot
          - Test media displays correctly in all contexts
          - Test media deletion cascades correctly
          - Test backward compatibility with existing surveys
          - Test concurrent users uploading media
          - All tests pass consistently
        subtasks:
          - name: Test web survey creation
            description: Create survey with media via admin panel
          - name: Test bot survey taking
            description: Take media survey via Telegram
          - name: Test media display
            description: Verify media shows in web and bot
          - name: Test deletion
            description: Delete question with media
          - name: Test backward compatibility
            description: Existing plain text questions work
          - name: Test concurrency
            description: Multiple users upload simultaneously

      - id: TASK-MM-046
        name: User acceptance testing (UAT)
        description: |
          Conduct UAT with real users to validate multimedia features.
          Gather feedback and identify usability issues.
        type: test
        priority: MEDIUM
        assigned_to: project-manager
        dependencies: [TASK-MM-045]
        effort_hours: 6
        parallel_safe: true
        files_created:
          - docs/uat-report-multimedia.md
        files_modified: []
        acceptance_criteria:
          - At least 5 users complete UAT scenarios
          - Test scenario: Create image-based survey
          - Test scenario: Create video tutorial survey
          - Test scenario: Take multimedia survey
          - Test scenario: View results with media
          - Usability issues documented
          - Feedback incorporated into final release
        subtasks:
          - name: Recruit UAT participants
            description: Find 5+ users for testing
          - name: Create UAT scenarios
            description: Detailed step-by-step test scenarios
          - name: Conduct UAT sessions
            description: Guide users through scenarios
          - name: Collect feedback
            description: Survey and interview participants
          - name: Document issues
            description: Create issue list from feedback
          - name: Prioritize fixes
            description: Determine must-fix vs nice-to-have

      - id: TASK-MM-047
        name: Bug fixes from testing
        description: |
          Fix all critical and high-priority bugs discovered during testing phases.
          Address usability issues identified in UAT.
        type: bugfix
        priority: CRITICAL
        assigned_to: all-agents
        dependencies: [TASK-MM-046]
        effort_hours: 16
        parallel_safe: false
        files_created: []
        files_modified:
          - Various files based on bugs
        acceptance_criteria:
          - All critical bugs fixed
          - All high-priority bugs fixed
          - Medium-priority bugs assessed for inclusion
          - Regression tests added for bug fixes
          - No new bugs introduced by fixes
          - All fixes tested and verified
        subtasks:
          - name: Triage bugs
            description: Prioritize all reported bugs
          - name: Fix critical bugs
            description: Address blockers and data loss issues
          - name: Fix high-priority bugs
            description: Address major functionality issues
          - name: Add regression tests
            description: Test cases to prevent bug recurrence
          - name: Verify fixes
            description: Re-test all fixed issues

      - id: TASK-MM-048
        name: Create release notes and changelog
        description: |
          Write comprehensive release notes for multimedia support feature.
          Include changelog, migration guide, known issues.
        type: documentation
        priority: MEDIUM
        assigned_to: project-manager
        dependencies: [TASK-MM-047]
        effort_hours: 3
        parallel_safe: true
        files_created:
          - RELEASE_NOTES_v2.0.0.md
          - CHANGELOG_v2.0.0.md
        files_modified:
          - CLAUDE.md
        acceptance_criteria:
          - Release notes cover all new features
          - Breaking changes documented (if any)
          - Migration guide included
          - Known issues listed
          - Contributors acknowledged
          - Screenshots of new features included
        subtasks:
          - name: Write feature summary
            description: High-level overview of multimedia support
          - name: List all changes
            description: Detailed changelog of all changes
          - name: Document breaking changes
            description: Any API or behavior changes
          - name: Write migration guide
            description: Steps to upgrade from v1.x
          - name: List known issues
            description: Any remaining bugs or limitations
          - name: Add screenshots
            description: Visual examples of new features

      - id: TASK-MM-049
        name: Final production deployment
        description: |
          Deploy multimedia support feature to production environment.
          Execute database migration, deploy code, verify functionality.
        type: deployment
        priority: CRITICAL
        assigned_to: devops-agent
        dependencies: [TASK-MM-048]
        effort_hours: 4
        parallel_safe: false
        files_created: []
        files_modified: []
        acceptance_criteria:
          - Production database backed up
          - Database migration executed successfully
          - API deployed with zero downtime
          - Frontend deployed and cache busted
          - Health checks pass
          - Smoke tests pass in production
          - Rollback plan ready
          - No errors in production logs
        subtasks:
          - name: Backup production database
            description: Full database backup before migration
          - name: Run database migration
            description: Apply MediaContent column migration
          - name: Deploy API
            description: Blue-green or rolling deployment
          - name: Deploy frontend
            description: Build and deploy with cache busting
          - name: Run health checks
            description: Verify all services healthy
          - name: Run smoke tests
            description: Test critical paths in production
          - name: Monitor logs
            description: Watch for errors for 1 hour

      - id: TASK-MM-050
        name: Post-release monitoring and support
        description: |
          Monitor production for issues after release.
          Provide support for any issues encountered by users.
        type: support
        priority: HIGH
        assigned_to: all-agents
        dependencies: [TASK-MM-049]
        effort_hours: 8
        parallel_safe: true
        files_created:
          - docs/post-release-report.md
        files_modified: []
        acceptance_criteria:
          - Monitor production logs for 48 hours
          - Track error rates and performance metrics
          - Respond to user issues within 4 hours
          - Create hotfix if critical issues found
          - Document all production issues
          - Post-release report completed
        subtasks:
          - name: Setup monitoring dashboards
            description: Real-time metrics for media operations
          - name: Monitor error rates
            description: Watch for increase in errors
          - name: Monitor performance
            description: Track latency and throughput
          - name: Respond to user issues
            description: Support tickets and feedback
          - name: Create hotfixes
            description: Deploy urgent fixes if needed
          - name: Write post-release report
            description: Summary of release and issues

# ============================================================================
# Dependencies Summary
# ============================================================================
dependency_graph:
  critical_path:
    - TASK-MM-001  # Design schema
    - TASK-MM-002  # Extend entity
    - TASK-MM-004  # Configure JSONB
    - TASK-MM-005  # Migration
    - TASK-MM-007  # Storage interface
    - TASK-MM-008  # Storage implementation
    - TASK-MM-010  # Upload endpoint
    - TASK-MM-014  # Install React packages
    - TASK-MM-016  # Rich text editor
    - TASK-MM-018  # Update QuestionForm
    - TASK-MM-045  # Integration testing
    - TASK-MM-047  # Bug fixes
    - TASK-MM-049  # Deployment

  parallel_opportunities:
    group_1:
      - TASK-MM-003  # MediaItem DTOs (parallel with MM-002)
      - TASK-MM-006  # Helper utility (parallel with MM-005)

    group_2:
      - TASK-MM-009  # Validation service (parallel with MM-008)
      - TASK-MM-015  # MediaPicker (parallel with MM-010)

    group_3:
      - TASK-MM-017  # MediaGallery (parallel with MM-016)
      - TASK-MM-021  # Bot media service (parallel with MM-018)

    group_4:
      - TASK-MM-026  # Unit tests helper (parallel with MM-022)
      - TASK-MM-027  # Unit tests storage (parallel with MM-022)
      - TASK-MM-028  # Unit tests validation (parallel with MM-022)

# ============================================================================
# Effort Summary
# ============================================================================
effort_summary:
  by_phase:
    phase_1: 16 hours
    phase_2: 33 hours
    phase_3: 46 hours
    phase_4: 27 hours
    phase_5: 51 hours
    phase_6: 17 hours
    phase_7: 27 hours
    phase_8: 47 hours

  total_hours: 264
  total_days: 33 (assuming 8-hour days)
  total_weeks: 6.6

  by_priority:
    critical: 112 hours
    high: 94 hours
    medium: 51 hours
    low: 7 hours

  by_agent:
    database_agent: 14 hours
    backend_agent: 62 hours
    frontend_agent: 46 hours
    bot_agent: 27 hours
    testing_agent: 51 hours
    project_manager: 13 hours
    devops_agent: 8 hours
    all_agents: 24 hours

# ============================================================================
# Risk Assessment
# ============================================================================
risks:
  - id: RISK-001
    description: Media files could consume significant disk space
    severity: MEDIUM
    mitigation: Implement file size limits, compression, and cleanup job
    owner: backend-agent

  - id: RISK-002
    description: Large media uploads may timeout
    severity: MEDIUM
    mitigation: Increase upload timeout, implement chunked uploads if needed
    owner: backend-agent

  - id: RISK-003
    description: Backward compatibility with existing questions
    severity: HIGH
    mitigation: Thorough testing, null-safe code, default values
    owner: all-agents

  - id: RISK-004
    description: Telegram API limits for media sending
    severity: MEDIUM
    mitigation: Respect rate limits, implement retries, graceful degradation
    owner: bot-agent

  - id: RISK-005
    description: Security vulnerabilities in media upload
    severity: HIGH
    mitigation: Comprehensive validation, security testing, regular updates
    owner: backend-agent

  - id: RISK-006
    description: Database migration failures in production
    severity: HIGH
    mitigation: Test migration thoroughly, have rollback plan, backup data
    owner: database-agent

# ============================================================================
# Acceptance Criteria (Overall)
# ============================================================================
overall_acceptance_criteria:
  functionality:
    - Survey creators can add images to questions via web admin panel
    - Survey creators can add videos to questions via web admin panel
    - Survey creators can add audio to questions via web admin panel
    - Survey creators can add documents to questions via web admin panel
    - Multiple media items can be attached to a single question
    - Media displays correctly when taking surveys (web and Telegram)
    - Media can be deleted individually
    - Existing plain text questions continue to work without changes

  performance:
    - Media upload completes within 10 seconds for files under 10MB
    - Page load time increases by less than 200ms with media
    - API response time increases by less than 100ms for questions with media

  security:
    - Only authenticated users can upload media
    - Users can only delete their own media
    - File type validation prevents malicious uploads
    - File size limits enforced
    - No XSS vulnerabilities in media rendering

  quality:
    - All unit tests pass with >80% coverage
    - All integration tests pass
    - All E2E tests pass
    - No critical or high-priority bugs in production
    - User acceptance testing successful (>80% satisfaction)

  documentation:
    - API endpoints fully documented in Swagger
    - Developer documentation complete
    - User guide complete
    - Migration guide complete
